# Deposits Console App — Руководство по запуску и использованию

**Репозиторий:** [https://github.com/pivovarenik/projectRice.git](https://github.com/pivovarenik/projectRice.git)

Кратко: консольное приложение на чистом C# для работы с депозитами. Входные данные — `deposits.xml`. Приложение выполняет операции над счетами (открыть/пополнить/снять/начислить проценты/закрыть), умеет валидировать вход и генерировать отчёты (`.txt`, `.csv`, `.xml`).

---

## Содержание файла

1. Назначение
2. Требования проекта
3. Структура входного XML (`deposits.xml`) — пример
4. Запуск и примеры команд
5. Формат отчётов
6. Валидация и пограничные случаи
7. Сборка и запуск (dotnet CLI)
8. Тесты
9. Частые вопросы
10. Как добавить этот файл в GitHub

---

## 1. Назначение

Этот файл описывает, как открыть и использовать консольное приложение для работы с депозитами, как подготовить `deposits.xml`, какие операции доступны, какие отчёты генерируются и как корректно экспортировать данные (особенно CSV, который должен открываться в Excel без сдвигов колонок).

## 2. Требования проекта

- .NET SDK (версия 6.0+ рекомендована).
- Проект реализован на чистом C# (без сторонних heavy-библиотек).
- Соблюдены требования задания:

  - Базовый класс с ≥3 методами (1–2 `virtual`) + наследник как `partial` класс (поля/свойства в одном файле; методы/const/readonly/static — в другом).
  - Есть хотя бы один extension method.
  - Есть хотя бы один делегат или событие.
  - Вход — XML (LINQ to XML): чтение, базовая валидация, модификация.
  - Коллекции объектов и LINQ-операции (фильтры, проекции, агрегаты, группировки).
  - Генерация минимум 2 отчётов (например: `statement.txt` и `summary.csv`).

## 3. Структура входного XML (`deposits.xml`) — пример

```xml
<?xml version="1.0" encoding="utf-8"?>
<Deposits>
  <Deposit>
    <Id>1</Id>
    <Name>Standard Savings</Name>
    <Rate>0.035</Rate>
    <Capitalization>true</Capitalization>
    <MinAmount>1000.00</MinAmount>
    <Opened>2024-01-01</Opened>
    <Closed></Closed>
    <Balance>1500.00</Balance>
  </Deposit>
  <!-- минимум 5 депозитов -->
</Deposits>
```

**Поля**: `id`, `name`, `rate` (в виде десятичной дроби), `capitalization` (bool), `minAmount` (decimal), `opened` (date), `closed` (date или пусто), `balance` (decimal).

## 4. Запуск и примеры команд

Сборка (в корне проекта):

```bash
dotnet build -c Release
```

Запуск (если проект — консольное приложение):

```bash
dotnet run --project Path/To/ConsoleProject -- deposits.xml
```

Примеры команд (в приложении реализовано простое текстовое меню и/или аргументы командной строки):

- `open <depositId> <amount>` — открыть счёт с указанной суммой (проверяется `minAmount`).
- `calc <depositId> <date>` — посчитать проценты/остаток на заданную дату.
- `withdrawInterest <depositId>` — снять начисленные проценты на счёте.
- `deposit <depositId> <amount>` — пополнить счёт.
- `close <depositId> <date>` — закрыть счёт (проверка диапазона договора).
- `export statement <depositId> <fromDate> <toDate> <path>` — экспорт выписки в CSV.
- `export summary <path>` — экспорт summary.csv с доходностью по счетам.

**Пример интерактивной сессии:**

```
> open 3 2000
Операция выполнена: счёт 3 открыт, баланс 2000.00
> calc 3 2024-12-31
Проценты за период: 45.67, новый баланс: 2045.67
> withdrawInterest 3
Проценты сняты: 45.67
> export statement 3 2024-01-01 2024-12-31 ./output/statement.csv
Файл ./output/statement.csv создан (UTF-8).
```

> Примечание: если приложение принимает аргументы — проверьте `--help` или `-h`.

## 5. Формат отчётов

### statement.csv (кодировка UTF-8)

Строки: `дата;операция;сумма;остаток;комментарий`

- Разделитель — точка с запятой `;` чтобы Excel корректно понял поля при локали с `,` десятичным разделителем.
- Комментарии, содержащие запятую или точку с запятой, **экранируются** кавычками `"`.
- Пример строки:

  ```csv
  2024-12-31;Начисление процентов;45.67;2045.67;"Процент за период, включая капитализацию"
  ```

### statement.txt

- Человекочитаемый лог: `дата — операция — сумма — остаток` в строке.

### summary.csv

- Строки: `счёт;доход` — итоговая доходность за период для каждого счёта.

### Требования совместимости с Excel

- Использовать `;` как разделитель.
- Кодировка — `UTF-8` (Excel на Windows корректно откроет CSV при импорте; при проблемах — открыть через мастер импорта и указать `;` разделитель и UTF-8).

## 6. Валидация и пограничные случаи

- Сумма при открытии/пополнении должна быть ≥ `minAmount` (для открытия) или ≥ 0 (для пополнения).
- Дата операций должна попадать в период действия договора (между `Opened` и `Closed`, если `Closed` не пуст).
- Экранировать кавычки и разделители в CSV (см. п.5).
- Обработка неверных XML (отсутствующие поля, неверный формат числа/даты): приложение логирует ошибку и (в зависимости от режима) пропускает запись или завершает работу с кодом ошибки.

## 7. Сборка и запуск (dotnet CLI)

1. Клонируйте репозиторий (если ещё не склонирован):

```bash
git clone https://github.com/pivovarenik/projectRice.git
cd projectRice
```

2. Перейдите в папку консольного проекта (замените `ConsoleApp` на реальное имя проекта):

```bash
cd src/Deposits.ConsoleApp
```

3. Соберите проект:

```bash
dotnet build -c Release
```

4. Запустите с указанием входного XML:

```bash
dotnet run -- deposits.xml
```

**Сборка без предупреждений:** рекомендуется включить строгие правила компиляции в `.csproj`:

```xml
<PropertyGroup>
  <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
  <WarningsAsErrors>CS0168;CS0219</WarningsAsErrors> <!-- пример -->
</PropertyGroup>
```

(настройте по необходимости).

## 8. Тесты

- Рекомендуется иметь набор unit-тестов для:

  - Парсинга XML (корректные/повреждённые входы).
  - Бизнес-логики (начисления процентов, валидация minAmount, вычисления на дату).
  - Генерации CSV (экранирование, разделители).

Запуск тестов:

```bash
dotnet test
```

## 9. Частые вопросы

**Q:** CSV не открывается в Excel корректно — поля съезжают.
**A:** При локали, где разделитель дробной части — запятая, Excel может некорректно распознать. Используйте `;` в качестве разделителя и кодировку UTF-8. При необходимости импортируйте файл через мастер данных и явно укажите `;`.

**Q:** Как задать формат дат в CSV?
**A:** Рекомендуется использовать ISO формат `YYYY-MM-DD`.

## 10. Как добавить этот файл в GitHub

1. Сохраните содержимое README как `README_deposits_console.md` в корне репозитория или в директории `docs/`.
2. Выполните:

```bash
git checkout -b docs/deposits-readme
git add README_deposits_console.md
git commit -m "Add README for Deposits Console App (usage, formats, examples)"
git push -u origin docs/deposits-readme
```

3. Создайте Pull Request через интерфейс GitHub.

---

Если хотите — могу:

- внести изменения в текст (корректировки, перевод, расширенные примеры команд);
- подготовить готовый файл `README_deposits_console.md`, который можно скачать/закоммитить (скачаиваемый файл можно создать по вашему желанию).

Удачи!
